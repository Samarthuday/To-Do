<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2/dist/tailwind.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/npm/daisyui@2.18.0/dist/full.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="res/favicon.ico">
    <link rel="stylesheet" href="mainstyle.css">
    <title>TaskMaster</title>
    <style>
        .wide-button {
            width: 100px; /* Adjust the width as needed */
        }
        .task-buttons {
    display: flex;
    flex-direction: column;
    gap: 5px; /* Adjust the gap between buttons as needed */
}

.task-buttons button {
    width: 100px; /* Adjust the width as needed */
    margin-top: 5px;
    border: 2px solid white; /* Add some margin to space out buttons */
}

    </style>
</head>
<body class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <aside class="bg-gray-800 text-white w-64 flex-shrink-0 p-4">
        <h1 class="text-2xl font-bold mb-4">TaskMaster</h1>

        <!-- Priority Dropdown -->
        <section class="mb-6">
            <div class="dropdown dropdown-hover">
                <label tabindex="0" class="btn m-1 hover:bg-gray-700">Priority</label>
                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li onclick="filterByPriority('High')">
                        <a class="hover:bg-gray-200 hover:text-gray-900"><i class='bx bxs-up-arrow-circle text-red-500'></i> High</a>
                    </li>
                    <li onclick="filterByPriority('Medium')">
                        <a class="hover:bg-gray-200 hover:text-gray-900"><i class='bx bxs-up-arrow text-orange-500'></i> Medium</a>
                    </li>
                    <li onclick="filterByPriority('Low')">
                        <a class="hover:bg-gray-200 hover:text-gray-900"><i class='bx bxs-down-arrow text-blue-500'></i> Low</a>
                    </li>
                </ul>
            </div>
        </section>

        <!-- Categories Dropdown -->
        <section class="mb-6">
            <div class="dropdown dropdown-hover">
                <label tabindex="0" class="btn m-1 hover:bg-gray-700">Categories</label>
                <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Work')">Work</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Personal')">Personal</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Home')">Home</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Fitness')">Fitness</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Shopping')">Shopping</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Errands')">Errands</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Health')">Health</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Family')">Family</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Finance')">Finance</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Hobbies')">Hobbies</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Social')">Social</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Education')">Education</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Travel')">Travel</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Projects')">Projects</a></li>
                    <li><a class="hover:bg-gray-200 hover:text-gray-900" onclick="filterByCategory('Miscellaneous')">Miscellaneous</a></li>
                </ul>
            </div>
        </section>
        <div class="dropdown dropdown-hover">
            <label tabindex="0" class="btn wide-button">Status</label>
            <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                <li onclick="filterByStatus('Pending')"><a>Pending</a></li>
                <li onclick="filterByStatus('Completed')"><a>Completed</a></li>
            </ul>
        </div>
        <!-- Trash Dropdown -->
    </aside>

    <!-- Logout Button & Theme Selector -->
    <section>
        <div class="absolute bottom-4 left-4">
            <a href="index.html"><button class="btn btn-error" id="logout-button">Logout</button></a>
        </div>
    </section>

    <!-- Main Content -->
    <div class="flex-grow flex flex-col">
        <header class="flex justify-between items-center p-4 bg-gray-900 text-white">
            <div class="input-section flex items-center">
                <input type="text" placeholder="Add a todo . . ." class="input input-bordered input-secondary mr-2" id="new-task-text">
                <input type="date" class="input input-bordered input-secondary mr-2" id="new-task-date">
                <input type="time" class="input input-bordered input-secondary mr-2" id="new-task-time">
                <select id="priority-select" class="select select-bordered select-secondary mr-2">
                    <option value="">Select Priority</option>
                    <option value="High">High</option>
                    <option value="Medium">Medium</option>
                    <option value="Low">Low</option>
                </select>
                <select id="category-select" class="select select-bordered select-secondary mr-2">
                    <option value="">Select Category</option>
                    <option value="Work">Work</option>
                    <option value="Personal">Personal</option>
                    <option value="Home">Home</option>
                    <option value="Fitness">Fitness</option>
                    <option value="Shopping">Shopping</option>
                    <option value="Errands">Errands</option>
                    <option value="Health">Health</option>
                    <option value="Family">Family</option>
                    <option value="Finance">Finance</option>
                    <option value="Hobbies">Hobbies</option>
                    <option value="Social">Social</option>
                    <option value="Education">Education</option>
                    <option value="Travel">Travel</option>
                    <option value="Projects">Projects</option>
                    <option value="Miscellaneous">Miscellaneous</option>
                </select>
                <button class="btn btn-secondary add-task-button" onclick="addTask()">
                    <i class="bx bx-plus bx-sm"></i>
                </button>
            </div>
        </header>

        <table class="table w-full">
            <thead>
                <tr>
                    <th>Task</th>
                    <th>Due Date</th>
                    <th>Due Time</th>
                    <th>Priority</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody class="todos-list-body" id="todos-list-body">
                <!-- Tasks will be dynamically added here -->
            </tbody>
        </table>
    </div>

    <!-- Theme Toggle Button -->
    <div class="absolute bottom-4 right-4">
        <button class="btn btn-circle btn-primary" onclick="toggleTheme()">
            <i class='bx bx-moon text-xl'></i>
        </button>
    </div>
    <audio src="main_audio.mp3" id="notificationSound"></audio>
    <script>

let tasks = [];

document.addEventListener('DOMContentLoaded', function () {
    fetchTasksFromDatabase();
});

function addTask() {
    const taskText = document.getElementById('new-task-text').value;
    const taskDate = document.getElementById('new-task-date').value;
    const taskTime = document.getElementById('new-task-time').value;
    //alert(taskTime);
    const taskPriority = document.getElementById('priority-select').value;
    const taskCategory = document.getElementById('category-select').value;

    if (taskText && taskDate && taskPriority && taskCategory &&taskTime) {
        const newTask = {
            text: taskText,
            date: taskDate,
            time: taskTime,
            priority: taskPriority,
            category: taskCategory,
            status: 'Pending'
        };

        tasks.push(newTask);
        renderTasks(tasks);
        
        saveTaskToDatabase(newTask);
        fetchTasks();
    } else {
        alert('Please fill in all fields.');
    }
}

function addReminder(taskText, taskCategory, dateTimeString)
{

}

function fetchTasks() {
    const xhr = new XMLHttpRequest();
    xhr.open('GET', 'fetch_tasks.php', true);
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                tasks = JSON.parse(xhr.responseText);
                renderTasks(tasks);
                renderTrashDropdown(tasks);
            } else {
                console.error('Failed to fetch tasks.');
            }
        }
    };
    xhr.send();
}

function renderTasks(tasks) {
    const taskList = document.getElementById('task-list');
    taskList.innerHTML = ''; // Clear existing content
    tasks.forEach((task, index) => {
        if (task.status !== 'deleted') {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${task.task}</span>
                <button onclick="deleteTask(${index})">Delete</button>
            `;
            taskList.appendChild(li);
        }
    });
}

function moveTaskToTrash(index) {
    const task = tasks[index];
    tasks.splice(index, 1);
    renderTasks(tasks);

    // Move task to trash in the database
    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'move_to_trash.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                console.log('Task moved to trash successfully.');
                renderTrashDropdown(tasks);
            } else {
                console.error('Failed to move task to trash.');
            }
        }
    };
    xhr.send(`task=${encodeURIComponent(task.task)}`);
}

// Call fetchTasks when the page loads
//window.onload = fetchTasks;

function renderTasks(taskList) {
    const tableBody = document.getElementById('todos-list-body');
    tableBody.innerHTML = '';

    taskList.forEach((task, index) => {
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>${task.task}</td>
            <td>${task.due_date}</td>
            <td>${task.due_time}</td>
            <td>${task.priority}</td>
            <td>${task.category}</td>
            <td>${task.status}</td>
            <td>
            <div class = "task-buttons">
                <button onclick="updateTaskStatus(${index}, 'Completed')">Complete</button>
                <button onclick="updateTaskStatus(${index}, 'Pending')">Pending</button>
                <button onclick="deleteTask(${index})">Delete</button>
            </div>
            </td>
        `;
        tableBody.appendChild(newRow);
    });
}
function deleteTask(index) {
    const task = tasks[index];

    // Update task status to 'deleted' in the database
    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'delete_task.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                if (response.status === 'success') {
                    console.log(response.message);
                    tasks.splice(index, 1); // Remove task from local array
                    renderTasks(tasks); // Re-render tasks list
                } else {
                    console.error(response.message);
                }
            } else {
                console.error('Failed to delete task.');
            }
        }
    };
    xhr.send(`task=${encodeURIComponent(task.task)}`);
}

function updateTaskStatus(index, status) {
    const task = tasks[index];
    task.status = status;
    renderTasks(tasks);

    // Update status in the database
    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'update_task.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                console.log('Task status updated successfully.');
            } else {
                console.error('Failed to update task status.');
            }
        }
    };
    xhr.send(`task=${encodeURIComponent(task.task)}&status=${encodeURIComponent(status)}`);
}



function moveToTrash(index) {
    const task = tasks[index];
    tasks.splice(index, 1);
    renderTasks(tasks);

    // Move task to trash in the database
    moveTaskToTrashInDatabase(task);
}

function deleteTaskFromDatabase(task) {
    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'delete_task.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                console.log('Task deleted successfully from database.');
            } else {
                console.error('Failed to delete task from database.');
            }
        }
    };
    xhr.send(`task=${task.text}`);
}

function saveTaskToDatabase(task) {
    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'save_task.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                console.log('Task saved successfully.');
            } else {
                console.error('Failed to save task.');
            }
        }
    };
    xhr.send(`task=${task.text}&due_date=${task.date}&due_time=${task.time}&priority=${task.priority}&category=${task.category}&status=${task.status}`);
}

function updateTaskInDatabase(task) {
    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'update_task.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                console.log('Task status updated successfully.');
            } else {
                console.error('Failed to update task status.');
            }
        }
    };
    xhr.send(`task=${task.text}&status=${task.status}`);
}

function moveTaskToTrashInDatabase(task) {
    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'move_to_trash.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                console.log('Task moved to trash successfully.');
                // After moving to trash, delete task from database
                deleteTaskFromDatabase(task);
            } else {
                console.error('Failed to move task to trash.');
            }
        }
    };
    xhr.send(`task=${task.text}`);
}

function fetchTasksFromDatabase() {
    fetch('fetch_tasks.php', {
        method: 'GET'
    })
    .then(response => response.json())
    .then(data => {
        tasks = data;
         // Update tasks array with fetched data
        renderTasks(tasks); // Render tasks in the HTML table
    })
    .catch(error => console.error('Error fetching tasks:', error));
}

function filterByPriority(priority) {
    const filteredTasks = tasks.filter(task => task.priority === priority);
    renderTasks(filteredTasks);
}

function filterByCategory(category) {
    const filteredTasks = tasks.filter(task => task.category === category);
    renderTasks(filteredTasks);
}
function filterByStatus(status) {
    const filteredTasks = tasks.filter(task => task.status === status);
    renderTasks(filteredTasks);
}
function filterTodos(status) {
    let filteredTasks = [];
    if (status === 'Pending') {
        filteredTasks = tasks.filter(task => task.status.lower() === 'Pending');
    } else if (status === 'Completed') {
        filteredTasks = tasks.filter(task => task.status.lower() === 'Completed');
    } else {
        filteredTasks = tasks; // Show all tasks
    }
    renderTasks(filteredTasks);
}

function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
}
    </script>
</body>
</html>
